<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diego Crisafulli — Front-end & Software Engineer</title>
    <meta name="description" content="I build fast, human-friendly data tools. Cut LCP 4.2s→1.6s; −41% bundles; AI ops tools used by 3 teams.">
    <meta name="author" content="Diego Crisafulli">
    <meta name="robots" content="index,follow">
    <link rel="canonical" href="https://diegocrisafu.github.io/diegoc55.github.io/">
    <meta name="theme-color" content="#2a4d69">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Diego Crisafulli — Front-end & Software Engineer">
    <meta property="og:description" content="I build fast, human-friendly data tools. Cut LCP 4.2s→1.6s; −41% bundles; AI ops tools used by 3 teams.">
    <meta property="og:url" content="https://diegocrisafu.github.io/diegoc55.github.io/">
    <meta property="og:image" content="https://diegocrisafu.github.io/diegoc55.github.io/social-card.svg">
    <meta property="og:image:alt" content="Diego Crisafulli — Software Engineer">
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Diego Crisafulli — Front-end & Software Engineer">
    <meta name="twitter:description" content="I build fast, human-friendly data tools. Cut LCP 4.2s→1.6s; −41% bundles; AI ops tools used by 3 teams.">
    <meta name="twitter:image" content="https://diegocrisafu.github.io/diegoc55.github.io/social-card.svg">
    <!-- Performance hints for CDN deps -->
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="manifest" href="manifest.webmanifest">
    <!-- Link to the stylesheet for styling -->
    <link rel="stylesheet" href="style.css">
    <!-- Geist Sans font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Preload hero images: overlay (blurred) and underlay (clear) -->
    <link rel="preload" as="image" href="images/Golden Trunks and Blue Sky.png" />
    <link rel="preload" as="image" href="images/img_trees.png" />
    <!-- Chat config: define window.CHAT_API_BASE before app code runs -->
    <script src="./chat-config.js"></script>
    <!-- Include React and React‑DOM from a CDN -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <!-- Include modern Babel Standalone (v7) to transpile JSX in-browser -->
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Modular assistant logic -->
    <script src="assistant.js"></script>
    <!-- Mark JS as enabled ASAP for prerender-hiding -->
    <script>document.documentElement.classList.add('js-enabled');</script>
    
    <!-- JSON-LD Schema for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Diego Crisafulli",
        "jobTitle": "Software Engineer",
        "description": "Front-end + SWE building performant data visualizations and AI tools",
        "url": "https://diegocrisafu.github.io/diegoc55.github.io/",
        "image": "https://diegocrisafu.github.io/diegoc55.github.io/social-card.svg",
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "Portfolio inquiries"
        },
        "sameAs": [
            "https://linkedin.com/in/diegocrisafulli",
            "https://github.com/diegoc55"
        ],
        "knowsAbout": [
            "Software Engineering",
            "Front-end Development", 
            "Data Visualization",
            "Artificial Intelligence",
            "React",
            "JavaScript",
            "Python"
        ],
        "alumniOf": {
            "@type": "EducationalOrganization",
            "name": "University of California, Berkeley"
        }
    }
    </script>
    
        <!-- Surface runtime errors to the page for easier debugging on static hosting -->
        <script>
            window.addEventListener('error', function (e) {
                try {
                    var pre = document.createElement('pre');
                    pre.style.background = '#300';
                    pre.style.color = '#fff';
                    pre.style.padding = '8px';
                    pre.style.margin = '0';
                    pre.style.whiteSpace = 'pre-wrap';
                    pre.textContent = 'Error: ' + (e.error && e.error.stack || e.message || e.toString());
                    document.body.insertBefore(pre, document.body.firstChild);
                } catch (_) {}
            });
        </script>
                <!-- Structured data: Person -->
                <script type="application/ld+json">
                {
                    "@context": "https://schema.org",
                    "@type": "Person",
                    "name": "Diego Crisafulli",
                    "jobTitle": "Software Engineer",
                    "url": "https://diegocrisafu.github.io/diegoc55.github.io/",
                    "image": "https://diegocrisafu.github.io/diegoc55.github.io/social-card.svg",
                    "email": "mailto:diego.crisafu@gmail.com",
                    "sameAs": [
                        "https://www.linkedin.com/in/diegocrisafulli212bb0256",
                        "https://github.com/diegocrisafu"
                    ],
                    "knowsAbout": ["React", "TypeScript", "Data Visualization", "DevOps", "JavaScript", "Python", "Cloud Computing", "AI"]
                }
                </script>
</head>
<body data-hero-reveal="on">
    <a class="skip-link" href="#main-content">Skip to main content</a>
        <!-- Simple prerender content for crawlers and no-JS users; only visible without JS -->
        <noscript>
        <div id="prerender">
            <header>
                <h1>I build fast, human-friendly data tools.</h1>
                <p>Cut LCP 4.2s→1.6s, −41% bundles, shipped AI tools used by 3 teams.</p>
                <p>
                    <a href="#projects">View Projects</a>
                    ·
                    <a href="Diego_Resume.pdf" rel="noopener" target="_blank">Download Résumé</a>
                </p>
            </header>
            <main>
                <section aria-labelledby="xp-h">
                    <h2 id="xp-h">Experience</h2>
                    <p>DevOps and full‑stack engineer: pipelines on Azure/GitHub Actions, reliability work, and simulation/AI projects.</p>
                </section>
                <section aria-labelledby="proj-h">
                    <h2 id="proj-h">Projects</h2>
                    <ul>
                        <li>AI summarizer that trimmed report prep time 45% across 3 teams.</li>
                        <li>Real‑time dashboard streaming data with Python/Dash.</li>
                    </ul>
                </section>
            </main>
        </div>
        </noscript>
    <!-- Root element where our React app will mount -->
    <div id="root"></div>

    <!-- React application code (Babel will transpile JSX) -->
    <script type="text/babel" data-presets="env,react">
        /*
         * Top navigation bar component. Renders links that scroll to sections
         * within the page. The component sticks to the top of the viewport
         * so it remains visible when scrolling.
         */
        function NavBar(props) {
            // Local state for mobile menu toggling
            const [menuOpen, setMenuOpen] = React.useState(false);
            // Close the menu when a link is clicked
            const handleLinkClick = () => setMenuOpen(false);
            return (
                <nav className={`navbar ${menuOpen ? 'active' : ''}`}>
                    <a className="nav‑logo" href="#home">Diego Crisafulli</a>
                    {/* Hamburger menu button for small screens */}
                    <button
                        className="menu‑toggle"
                        aria-label="Toggle navigation"
                        aria-expanded={menuOpen}
                        aria-controls="primary-nav"
                        onClick={() => setMenuOpen((prev) => !prev)}
                    >
                        {menuOpen ? '\u00d7' : '\u2630'}
                    </button>
                    <ul id="primary-nav" className="nav‑links" onClick={handleLinkClick}>
                        <li><a href="#home" className={props.currentSection==='home'?'active':''} aria-current={props.currentSection==='home'?'page':undefined}>Home</a></li>
                        <li><a href="#projects" className={props.currentSection==='projects'?'active':''} aria-current={props.currentSection==='projects'?'page':undefined}>Projects</a></li>
                        <li><a href="#experience" className={props.currentSection==='experience'?'active':''} aria-current={props.currentSection==='experience'?'page':undefined}>Experience</a></li>
                        <li><a href="#writing" className={props.currentSection==='writing'?'active':''} aria-current={props.currentSection==='writing'?'page':undefined}>Writing</a></li>
                        <li><a href="#contact" className={props.currentSection==='contact'?'active':''} aria-current={props.currentSection==='contact'?'page':undefined}>Contact</a></li>
                    </ul>
                    {/* Right-side actions: Resume as primary, dark mode as icon */}
                    <div className="nav-actions">
                        <a href="Diego_Resume.pdf" className="header-resume-btn" target="_blank" rel="noopener noreferrer">Download Résumé</a>
                        <button
                            className="dark‑mode‑toggle icon"
                            onClick={props.toggleDarkMode}
                            aria-label={props.darkMode ? 'Switch to light mode' : 'Switch to dark mode'}
                            title={props.darkMode ? 'Light mode' : 'Dark mode'}
                        >
                            {props.darkMode ? '☀️' : '🌙'}
                        </button>
                    </div>
                </nav>
            );
        }

        /*
         * Section component used for layout. Accepts an id, title and children.
         * Helps to keep the markup for each section clean and consistent.
         */
        function Section({ id, title, children }) {
            return (
                <section id={id} className="section">
                    <h2>{title}</h2>
                    <div className="section‑content">{children}</div>
                </section>
            );
        }

                // Lightweight Snake mini-game rendered on a Canvas.
                        function GameHero() {
                    const canvasRef = React.useRef(null);
                    const [running, setRunning] = React.useState(false);
                    const [score, setScore] = React.useState(0);
                            const [best, setBest] = React.useState(() => {
                                const v = parseInt(localStorage.getItem('snakeBest') || '0', 10);
                                return isNaN(v) ? 0 : v;
                            });
                    const [started, setStarted] = React.useState(false);
                    const [gameOver, setGameOver] = React.useState(false);
                    const dirRef = React.useRef({ x: 1, y: 0 });
                    const snakeRef = React.useRef([{ x: 8, y: 12 }]);
                    const appleRef = React.useRef({ x: 14, y: 12 });
                    const lastTimeRef = React.useRef(0);
                    const accRef = React.useRef(0);
                    const grid = 20; // 20x15 grid on 400x300 canvas
                    const stepMs = 120; // speed
                            const touchRef = React.useRef(null);

                    const reset = () => {
                        snakeRef.current = [{ x: 8, y: 12 }];
                        dirRef.current = { x: 1, y: 0 };
                        appleRef.current = { x: Math.floor(Math.random()*grid), y: Math.floor(Math.random()*15) };
                        setScore(0);
                    };

                    React.useEffect(() => {
                        reset();
                        const onKey = (e) => {
                            const k = e.key;
                            const d = dirRef.current;
                            if (k === ' ' || k === 'Spacebar') {
                                e.preventDefault();
                                if (!started) { setStarted(true); setGameOver(false); setRunning(true); return; }
                                setRunning((r) => !r);
                                return;
                            }
                            if (k === 'ArrowUp' || k === 'w') { if (d.y === 0) dirRef.current = { x: 0, y: -1 }; }
                            else if (k === 'ArrowDown' || k === 's') { if (d.y === 0) dirRef.current = { x: 0, y: 1 }; }
                            else if (k === 'ArrowLeft' || k === 'a') { if (d.x === 0) dirRef.current = { x: -1, y: 0 }; }
                            else if (k === 'ArrowRight' || k === 'd') { if (d.x === 0) dirRef.current = { x: 1, y: 0 }; }
                        };
                        window.addEventListener('keydown', onKey);
                                    const onVis = () => { if (document.hidden) setRunning(false); };
                                    document.addEventListener('visibilitychange', onVis);
                                    return () => {
                                        window.removeEventListener('keydown', onKey);
                                        document.removeEventListener('visibilitychange', onVis);
                                    };
                    }, []);

                    React.useEffect(() => {
                        let rafId;
                        const loop = (t) => {
                            if (!running) { rafId = requestAnimationFrame(loop); return; }
                            const canvas = canvasRef.current;
                            if (!canvas) return;
                            const ctx = canvas.getContext('2d');
                            const w = canvas.width, h = canvas.height;
                            // fixed timestep
                            const dt = t - (lastTimeRef.current || t);
                            lastTimeRef.current = t;
                            accRef.current += dt;
                            if (accRef.current >= stepMs) {
                                accRef.current = 0;
                                // advance
                                const snake = [...snakeRef.current];
                                const head = { x: snake[0].x + dirRef.current.x, y: snake[0].y + dirRef.current.y };
                                // wrap
                                head.x = (head.x + grid) % grid;
                                head.y = (head.y + 15) % 15;
                                // self collision
                                                if (snake.some((s) => s.x === head.x && s.y === head.y)) {
                                                    setRunning(false);
                                                    setStarted(false);
                                                    setGameOver(true);
                                                    // store best
                                                    setBest((b) => {
                                                        const nb = Math.max(b, score);
                                                        localStorage.setItem('snakeBest', String(nb));
                                                        return nb;
                                                    });
                                } else {
                                    snake.unshift(head);
                                    // apple
                                    const apple = appleRef.current;
                                    if (head.x === apple.x && head.y === apple.y) {
                                        setScore((s) => s + 1);
                                        // place new apple not on snake
                                        let nx, ny;
                                        do {
                                            nx = Math.floor(Math.random() * grid);
                                            ny = Math.floor(Math.random() * 15);
                                        } while (snake.some((s) => s.x === nx && s.y === ny));
                                        appleRef.current = { x: nx, y: ny };
                                    } else {
                                        snake.pop();
                                    }
                                    snakeRef.current = snake;
                                }
                            }

                            // draw
                            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--background') || '#f5f7fa';
                            ctx.fillRect(0, 0, w, h);
                            // grid glow
                            ctx.strokeStyle = 'rgba(0,0,0,0.05)';
                            for (let x=0; x<=w; x+=20) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke(); }
                            for (let y=0; y<=h; y+=20) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke(); }
                            // apple
                            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--secondary') || '#4b86b4';
                            ctx.fillRect(appleRef.current.x*20+2, appleRef.current.y*20+2, 16, 16);
                            // snake
                            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--primary') || '#2a4d69';
                            snakeRef.current.forEach((s, i) => {
                                ctx.globalAlpha = Math.max(0.6, 1 - i*0.02);
                                ctx.fillRect(s.x*20+2, s.y*20+2, 16, 16);
                            });
                            ctx.globalAlpha = 1;
                            rafId = requestAnimationFrame(loop);
                        };
                        rafId = requestAnimationFrame(loop);
                        return () => cancelAnimationFrame(rafId);
                    }, [running]);

                                const handleStartPause = () => { if (!started) { setStarted(true); setGameOver(false); setRunning(true); } else { setRunning((r) => !r); } };
                    const handleRestart = () => { reset(); setGameOver(false); setStarted(true); setRunning(true); };

                                const onTouchStart = (e) => {
                                    const t = e.changedTouches[0];
                                    touchRef.current = { x: t.clientX, y: t.clientY };
                                };
                                const onTouchEnd = (e) => {
                                    if (!touchRef.current) return;
                                    const t = e.changedTouches[0];
                                    const dx = t.clientX - touchRef.current.x;
                                    const dy = t.clientY - touchRef.current.y;
                                    const adx = Math.abs(dx), ady = Math.abs(dy);
                                    const d = dirRef.current;
                                    if (Math.max(adx, ady) < 18) return; // small swipe threshold
                                    if (adx > ady) {
                                        if (dx > 0 && d.x === 0) dirRef.current = { x: 1, y: 0 };
                                        else if (dx < 0 && d.x === 0) dirRef.current = { x: -1, y: 0 };
                                    } else {
                                        if (dy > 0 && d.y === 0) dirRef.current = { x: 0, y: 1 };
                                        else if (dy < 0 && d.y === 0) dirRef.current = { x: 0, y: -1 };
                                    }
                                    touchRef.current = null;
                                };

                    return (
                                    <div className="game-hero" onTouchStart={onTouchStart} onTouchEnd={onTouchEnd}>
                                        <div className="game-scorebar">
                                            <span className="game-score">Score: {score}</span>
                                            <span className="game-best">Best: {best}</span>
                                        </div>
                                        <canvas ref={canvasRef} width="400" height="300" className="game-canvas" aria-label="Snake game area"></canvas>
                            <div className="game-controls">
                                            <button className="button download‑btn" onClick={handleStartPause}>{started ? (running ? 'Pause' : 'Resume') : 'Play'}</button>
                                <button className="game-restart" onClick={handleRestart}>Restart</button>
                            </div>
                            <div className="game-help">Use arrow keys or WASD (or swipe) to move. Space toggles play/pause.</div>
                                        {!started && !gameOver && (
                                            <div className="game-overlay start">Press Space or Play to begin</div>
                                        )}
                                        {gameOver && (
                                            <div className="game-overlay">Game Over — Score {score}. Press Restart.</div>
                                        )}
                        </div>
                    );
                }

                // 2048 Game (compact, keyboard+touch)
                function Game2048(){
                    const [size, setSize] = React.useState(4);
                    const [grid, setGrid] = React.useState(() => initGrid(4));
                    const [score, setScore] = React.useState(0);
                    const [best, setBest] = React.useState(() => parseInt(localStorage.getItem('g2048Best')||'0',10)||0);
                    const [over, setOver] = React.useState(false);
                    const [win, setWin] = React.useState(false);
                    const [history, setHistory] = React.useState([]); // stack of {grid, score}
                    const [spawnPos, setSpawnPos] = React.useState(null); // 'r-c'
                    const [mergeSet, setMergeSet] = React.useState(()=> new Set()); // of 'r-c'
                    const [animating, setAnimating] = React.useState(false);
                    const touchRef = React.useRef(null);

                    function blank(n){ return Array.from({length:n},()=>Array(n).fill(0)); }
                    function initGrid(n){
                        const first = spawn(blank(n), n);
                        const second = spawn(first.grid, n);
                        return second.grid;
                    }
                    function clone(g){ return g.map(r=>r.slice()); }
                    function spawn(g,n){
                        if(!g || !Array.isArray(g)) return { grid: blank(n), pos: null };
                        const empty=[]; for(let r=0;r<n;r++) for(let c=0;c<n;c++) if(!g[r][c]) empty.push([r,c]);
                        if(!empty.length) return {grid:g, pos:null};
                        const [r,c]=empty[Math.floor(Math.random()*empty.length)];
                        const v=Math.random()<0.9?2:4; const ng=clone(g); ng[r][c]=v; return {grid:ng, pos:`${r}-${c}`};
                    }
                    function rotate(g){ // rotate right
                        const n=g.length; const out=blank(n);
                        for(let r=0;r<n;r++) for(let c=0;c<n;c++) out[c][n-1-r]=g[r][c];
                        return out;
                    }
                    function compressRow(row){
                        const vals=row.filter(v=>v); let merged=[]; let adds=0; let mergedIdx=[];
                        for(let i=0;i<vals.length;i++){
                            if(i+1<vals.length && vals[i]===vals[i+1]){ const v=vals[i]*2; merged.push(v); adds+=v; mergedIdx.push(merged.length-1); i++; }
                            else merged.push(vals[i]);
                        }
                        while(merged.length<row.length) merged.push(0);
                        return {row:merged, adds, mergedIdx};
                    }
                    function any2048(g){ for(let r=0;r<g.length;r++) for(let c=0;c<g.length;c++) if(g[r][c]>=2048) return true; return false; }
                    function isGameOver(g){
                        const n=g.length;
                        for(let r=0;r<n;r++) for(let c=0;c<n;c++) if(!g[r][c]) return false;
                        for(let r=0;r<n;r++) for(let c=0;c<n;c++){
                            const v=g[r][c]; if((r+1<n && g[r+1][c]===v) || (c+1<n && g[r][c+1]===v)) return false;
                        }
                        return true;
                    }
                    function move(dir){ // 0=L,1=U,2=R,3=D
                        if(animating) return; // throttle while animating
                        setMergeSet(new Set()); setSpawnPos(null);
                        const n=size; let g=clone(grid);
                        const prev={grid:clone(grid), score};
                        for(let i=0;i<dir;i++) g=rotate(g);
                        let moved=false, add=0, mergedCoords=[];
                        g=g.map((r,ri)=>{ const {row,adds,mergedIdx}=compressRow(r); if(row.some((v,i)=>v!==r[i])) moved=true; add+=adds; mergedIdx.forEach(ci=>mergedCoords.push([ri,ci])); return row; });
                        for(let i=0;i<(4-dir)%4;i++) g=rotate(g);
                        if(moved){
                            setAnimating(true);
                            setHistory(h=>{ const nh=[...h, prev]; return nh.length>50 ? nh.slice(nh.length-50) : nh; });
                            const sp=spawn(g,n); setGrid(sp.grid); setSpawnPos(sp.pos);
                            // rotate merged coords back to original orientation
                            const back = (coords)=>{ let res=coords.map(x=>x); for(let i=0;i<(4-dir)%4;i++) res=res.map(([r,c])=>[c,n-1-r]); return res; };
                            const mset=new Set(back(mergedCoords).map(([r,c])=>`${r}-${c}`)); setMergeSet(mset);
                            setScore(s=>{ const ns=s+add; if(ns>best){ localStorage.setItem('g2048Best',String(ns)); setBest(ns); } return ns; });
                            if(!win && any2048(sp.grid)) setWin(true);
                            if(isGameOver(sp.grid)) setOver(true);
                            // release input after brief animation window
                            setTimeout(()=>setAnimating(false), 160);
                        }
                    }
                    function restart(n=size){ setGrid(initGrid(n)); setScore(0); setOver(false); setWin(false); setHistory([]); setSpawnPos(null); setMergeSet(new Set()); }
                    function undo(){ setHistory(h=>{ if(!h.length) return h; const prev=h[h.length-1]; setGrid(prev.grid); setScore(prev.score); setOver(false); setWin(false); setSpawnPos(null); setMergeSet(new Set()); return h.slice(0,-1); }); }
                    function changeSize(n){ setSize(n); restart(n); }

                    React.useEffect(()=>{
                        const onKey=(e)=>{
                            if(e.key==='ArrowLeft' || e.key==='a') move(0);
                            else if(e.key==='ArrowUp' || e.key==='w') move(1);
                            else if(e.key==='ArrowRight' || e.key==='d') move(2);
                            else if(e.key==='ArrowDown' || e.key==='s') move(3);
                            else if(e.key==='r') restart();
                            else if((e.metaKey||e.ctrlKey) && e.key.toLowerCase()==='z') undo();
                        };
                        window.addEventListener('keydown', onKey);
                        return ()=>window.removeEventListener('keydown', onKey);
                    },[grid, best, size, win]);

                    const onTouchStart=(e)=>{ const t=e.changedTouches[0]; touchRef.current={x:t.clientX,y:t.clientY}; };
                    const onTouchEnd=(e)=>{
                        if(!touchRef.current || animating) return; const t=e.changedTouches[0];
                        const dx=t.clientX-touchRef.current.x, dy=t.clientY-touchRef.current.y;
                        const adx=Math.abs(dx), ady=Math.abs(dy);
                        if(Math.max(adx,ady)<18) return; if(adx>ady) move(dx>0?2:0); else move(dy>0?3:1);
                        touchRef.current=null;
                    };

                    return (
                        <div className={`g2048 size${size}`} onTouchStart={onTouchStart} onTouchEnd={onTouchEnd}>
                            <div className="g2048-top">
                                <span>Score: {score}</span>
                                <span>Best: {best}</span>
                                <div className="g2048-controls">
                                    <button className="g2048-restart" onClick={()=>restart()}>Restart</button>
                                    <button className="g2048-restart" onClick={undo} disabled={!history.length} title="Undo (⌘/Ctrl+Z)">Undo</button>
                                    <div className="g2048-sizes">
                                        <button className={`g2048-restart ${size===4?'active':''}`} onClick={()=>changeSize(4)}>4×4</button>
                                        <button className={`g2048-restart ${size===5?'active':''}`} onClick={()=>changeSize(5)}>5×5</button>
                                    </div>
                                </div>
                            </div>
                            <div className={`g2048-grid size${size}`} role="grid" aria-label="2048 board">
                                {grid.map((row,ri)=> (
                                    <div key={ri} className="g2048-row" role="row">
                                        {row.map((v,ci)=> {
                                            const key=`${ri}-${ci}`;
                                            const spawned = spawnPos===key;
                                            const bumped = mergeSet.has(key);
                                            return (
                                                <div key={ci} className={`g2048-cell v${v||0} ${spawned?'spawn':''} ${bumped?'bump':''}`} role="gridcell" aria-label={v?String(v):'empty'}>{v||''}</div>
                                            );
                                        })}
                                    </div>
                                ))}
                            </div>
                            {(over || win) && (
                                <div className="g2048-over" role="alert">
                                    {win ? 'You win!' : 'Game Over'}
                                    {win && (
                                        <>
                                            {' '}<button className="g2048-restart" onClick={()=>setWin(false)}>Continue</button>
                                            {' '}<button className="g2048-restart" onClick={()=>restart()}>New Game</button>
                                        </>
                                    )}
                                </div>
                            )}
                            <div className="g2048-help">Use arrow keys/WASD or swipe. R: restart. Undo: ⌘/Ctrl+Z.</div>
                        </div>
                    );
                }

                // Minesweeper Game — enhanced (presets, first-click safety, chording, timer, wave animation, best times, custom difficulty)
                function GameMinesweeper(){
                    const PRESETS = [
                        { id:'beginner', name:'Beginner', w:9, h:9, mines:10 },
                        { id:'intermediate', name:'Intermediate', w:16, h:16, mines:40 },
                        { id:'expert', name:'Expert', w:30, h:16, mines:99 },
                        { id:'insane', name:'Insane', w:24, h:24, mines:120 },
                    ];
                    const [preset, setPreset] = React.useState(PRESETS[1]);
                    const [grid, setGrid] = React.useState(()=> makeEmpty(preset.w, preset.h));
                    const [started, setStarted] = React.useState(false);
                    const [over, setOver] = React.useState(false);
                    const [won, setWon] = React.useState(false);
                    const [seconds, setSeconds] = React.useState(0);
                    const [remaining, setRemaining] = React.useState(preset.mines);
                    const [flagMode, setFlagMode] = React.useState(false);
                    const [recent, setRecent] = React.useState(()=> new Set());
                    const [origin, setOrigin] = React.useState(null);
                    const [bests, setBests] = React.useState(()=> { try { return JSON.parse(localStorage.getItem('mswBestTimes')||'{}'); } catch { return {}; } });
                    const [showCustom, setShowCustom] = React.useState(false);
                    const [cw, setCw] = React.useState(12);
                    const [ch, setCh] = React.useState(12);
                    const [cm, setCm] = React.useState(20);

                    React.useEffect(()=>{ if(!started || over || won) return; const id=setInterval(()=> setSeconds(s=>Math.min(999,s+1)),1000); return ()=>clearInterval(id); },[started,over,won]);

                    function fmtTime(s){ const m=Math.floor(s/60), r=s%60; return `${m}:${r.toString().padStart(2,'0')}`; }
                    function makeEmpty(w,h){ return Array.from({length:h},()=> Array.from({length:w},()=>({ r:0,m:false,f:false,v:false,x:false }))); }
                    function inb(x,y){ return y>=0 && y<grid.length && x>=0 && x<grid[0].length; }
                    function neighbors(x,y){ const d=[-1,0,1], out=[]; for(let dy of d) for(let dx of d){ if(dx||dy){ const nx=x+dx, ny=y+dy; if(inb(nx,ny)) out.push([nx,ny]); } } return out; }
                    function withMines(w,h,mines,avoid){ const g=makeEmpty(w,h); const forbid=new Set(avoid.map(([ax,ay])=>`${ax},${ay}`)); const cand=[]; for(let y=0;y<h;y++) for(let x=0;x<w;x++){ const k=`${x},${y}`; if(!forbid.has(k)) cand.push([x,y]); } for(let i=cand.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [cand[i],cand[j]]=[cand[j],cand[i]]; } for(const [x,y] of cand.slice(0,Math.min(mines,cand.length))) g[y][x].m=true; for(let y=0;y<h;y++) for(let x=0;x<w;x++) if(!g[y][x].m) g[y][x].r=neighbors(x,y).reduce((a,[nx,ny])=>a+(g[ny][nx].m?1:0),0); return g; }
                    function revealFlood(g,x,y){ const stack=[[x,y]]; while(stack.length){ const [cx,cy]=stack.pop(); const c=g[cy][cx]; if(c.v||c.f) continue; c.v=true; if(!c.m && c.r===0){ for(const n of neighbors(cx,cy)){ const [nx,ny]=n; const cc=g[ny][nx]; if(!cc.v && !cc.f) stack.push([nx,ny]); } } } }
                    function countFlagsAround(g,x,y){ let c=0; for(const [nx,ny] of neighbors(x,y)) if(g[ny][nx].f) c++; return c; }
                    function hiddenSafe(g){ let c=0; for(let y=0;y<g.length;y++) for(let x=0;x<g[0].length;x++){ const cell=g[y][x]; if(!cell.m && !cell.v) c++; } return c; }
                    function totalFlags(g){ let c=0; for(let y=0;y<g.length;y++) for(let x=0;x<g[0].length;x++) if(g[y][x].f) c++; return c; }
                    function reset(to=preset){ setPreset(to); setGrid(makeEmpty(to.w,to.h)); setStarted(false); setOver(false); setWon(false); setSeconds(0); setRemaining(to.mines); setFlagMode(false); setRecent(new Set()); setOrigin(null); }

                    function finishWin(g){ for(let y=0;y<g.length;y++) for(let x=0;x<g[0].length;x++){ if(g[y][x].m){ g[y][x].f=true; g[y][x].v=true; }} setGrid(g); setWon(true); setOver(true); setBests(prev=>{ const cur=prev[preset.id]; const better=(cur==null||seconds<cur)?seconds:cur; const out={...prev,[preset.id]:better}; try{localStorage.setItem('mswBestTimes',JSON.stringify(out));}catch{} return out; }); }

                    function handleReveal(x,y){ if(over||won) return; const prev=grid; let g=grid.map(r=>r.map(c=>({...c}))); if(!started){ const avoid=[[x,y],...neighbors(x,y)]; g=withMines(preset.w,preset.h,preset.mines,avoid); setStarted(true);} const cell=g[y][x]; if(cell.v||cell.f){ setGrid(g); return;} if(cell.m){ cell.x=true; cell.v=true; for(let yy=0;yy<g.length;yy++) for(let xx=0;xx<g[0].length;xx++) if(g[yy][xx].m) g[yy][xx].v=true; setGrid(g); setOver(true); return;} revealFlood(g,x,y); const keys=[]; for(let yy=0;yy<g.length;yy++) for(let xx=0;xx<g[0].length;xx++) if(!prev[yy][xx].v && g[yy][xx].v) keys.push(`${xx}-${yy}`); setGrid(g); setOrigin({x,y}); setRecent(new Set(keys)); setTimeout(()=> setRecent(new Set()),500); if(hiddenSafe(g)===0) finishWin(g); setRemaining(Math.max(0,preset.mines-totalFlags(g))); }
                    function handleToggleFlag(x,y){ if(over||won) return; if(!started) setStarted(true); const g=grid.map(r=>r.map(c=>({...c}))); const cell=g[y][x]; if(cell.v){ setGrid(g); return;} cell.f=!cell.f; setGrid(g); setRemaining(Math.max(0,preset.mines-totalFlags(g))); }
                    function handleChord(x,y){ if(over||won) return; const prev=grid; const g=grid.map(r=>r.map(c=>({...c}))); const cell=g[y][x]; if(!cell.v||cell.r<=0) return; if(countFlagsAround(g,x,y)!==cell.r) return; let exploded=false; for(const [nx,ny] of neighbors(x,y)){ const n=g[ny][nx]; if(n.v||n.f) continue; if(n.m){ n.x=true; n.v=true; exploded=true;} else revealFlood(g,nx,ny);} if(exploded){ for(let yy=0;yy<g.length;yy++) for(let xx=0;xx<g[0].length;xx++) if(g[yy][xx].m) g[yy][xx].v=true; setGrid(g); setOver(true); return;} const keys=[]; for(let yy=0;yy<g.length;yy++) for(let xx=0;xx<g[0].length;xx++) if(!prev[yy][xx].v && g[yy][xx].v) keys.push(`${xx}-${yy}`); setGrid(g); setOrigin({x,y}); setRecent(new Set(keys)); setTimeout(()=> setRecent(new Set()),500); if(hiddenSafe(g)===0) finishWin(g); setRemaining(Math.max(0,preset.mines-totalFlags(g))); }
                    function onCellClick(e,x,y){ e.preventDefault(); if(flagMode || e.shiftKey||e.ctrlKey||e.metaKey) handleToggleFlag(x,y); else handleReveal(x,y); }
                    function onCellRight(e,x,y){ e.preventDefault(); handleToggleFlag(x,y); }
                    function onCellDouble(e,x,y){ e.preventDefault(); handleChord(x,y); }
                    React.useEffect(()=>{ setRemaining(Math.max(0,preset.mines-totalFlags(grid))); },[grid,preset]);

                    return (<div className="msw"> <div className="msw-top"> <div className="msw-counters"> <span className="msw-count">Mines: {remaining}</span> <span className="msw-count">Time: {seconds.toString().padStart(3,'0')}</span> <span className="msw-count">Best: {bests[preset.id]!=null?fmtTime(bests[preset.id]):'—'}</span> </div> <div className="msw-controls"> <div className="msw-diffs"> {PRESETS.map(p=> <button key={p.id} className={`msw-btn ${p.id===preset.id?'active':''}`} onClick={()=> reset(p)}>{p.name}</button>)} <button className={`msw-btn ${String(preset.id||'').startsWith('custom')?'active':''}`} onClick={()=> setShowCustom(x=>!x)}>Custom…</button> </div> <button className="msw-btn" onClick={()=> reset(preset)}>New Game</button> <button className={`msw-btn ${flagMode?'active':''}`} onClick={()=> setFlagMode(f=>!f)} title="Touch mode: place flags">Flag Mode</button> </div> {showCustom && <div className="msw-custom"> <label>W <input type="number" min="5" max="50" value={cw} onChange={e=> setCw(Math.max(5,Math.min(50,parseInt(e.target.value||'0',10))))}/></label> <label>H <input type="number" min="5" max="50" value={ch} onChange={e=> setCh(Math.max(5,Math.min(50,parseInt(e.target.value||'0',10))))}/></label> <label>M <input type="number" min="1" max={cw*ch-9} value={cm} onChange={e=> setCm(Math.max(1,Math.min(cw*ch-9,parseInt(e.target.value||'0',10))))}/></label> <button className="msw-btn" onClick={()=> { const w=cw,h=ch,mines=Math.min(cm,w*h-9); reset({id:`custom:${w}x${h}:${mines}`, name:'Custom', w,h,mines}); setShowCustom(false); }}>Start</button> </div>} </div> <div className="msw-grid-wrap"> <div className="msw-grid" style={{gridTemplateColumns:`repeat(${grid[0].length}, 28px)`}} role="grid" aria-label="Minesweeper board"> {grid.map((row,y)=> row.map((cell,x)=>{ const key=`${x}-${y}`; const classes=['msw-cell']; if(cell.v) classes.push('revealed'); if(cell.f) classes.push('flag'); if(cell.x) classes.push('exploded'); if(cell.v && !cell.m && cell.r>0) classes.push(`n${cell.r}`); const isRecent=recent.has(key); if(isRecent) classes.push('wave'); const d=origin?(Math.abs(x-origin.x)+Math.abs(y-origin.y)):0; return <button key={key} className={classes.join(' ')} style={{['--d']:d}} onClick={e=>onCellClick(e,x,y)} onContextMenu={e=>onCellRight(e,x,y)} onDoubleClick={e=>onCellDouble(e,x,y)} aria-label={!cell.v?(cell.f?'Flagged':'Hidden'):(cell.m?'Mine':`${cell.r||0}`)} disabled={over&&!cell.v}>{cell.v?(cell.m?'💣':(cell.r||'')):(cell.f?'🚩':'')}</button>; }))} </div> </div> {over && !won && <div className="msw-status lose" role="alert">Boom! Try again.</div>} {won && <div className="msw-status win" role="alert">Cleared! Congrats.</div>} <div className="msw-help">Tip: Right-click to flag, double-click numbers to chord. On touch, toggle Flag Mode.</div> </div>);
                }

                                // Web of Life (SVG radial graph) — polished, professional layout
                                function WebOfLife() {
                                    const center = { x: 300, y: 200 };
                                    const items = [
                                        { id: 'cv', label: 'CV', action: () => window.open('Diego_Resume.pdf','_blank') },
                                        { id: 'projects', label: 'Projects', action: () => scrollToId('projects') },
                                        { id: 'experience', label: 'Experience', action: () => scrollToId('experience') },
                                        { id: 'skills', label: 'Skills', action: () => scrollToId('skills') },
                                        { id: 'education', label: 'Education', action: () => scrollToId('education') },
                                        { id: 'contact', label: 'Contact', action: () => scrollToId('contact') }
                                    ];
                                    const [active, setActive] = React.useState(null);

                                    function scrollToId(id) {
                                        const el = document.getElementById(id);
                                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                    }

                                    // compute radial positions (two rings)
                                    const ring1 = 150, ring2 = 210;
                                    const positions = items.map((it, i) => {
                                        const ring = i < 3 ? ring1 : ring2;
                                        const idx = i < 3 ? i : i - 3;
                                        const count = i < 3 ? 3 : (items.length - 3);
                                        const angle = (Math.PI * 2 * (idx / count)) + (i < 3 ? -Math.PI/6 : Math.PI/6);
                                        return { ...it, x: center.x + ring * Math.cos(angle), y: center.y + ring * Math.sin(angle) };
                                    });

                                    return (
                                        <div className="wol2">
                                            <svg className="wol2-svg" viewBox="0 0 600 420" role="img" aria-label="Interactive map of Diego's work">
                                                <defs>
                                                    <filter id="ds"><feDropShadow dx="0" dy="4" stdDeviation="6" floodColor="#000" floodOpacity="0.25"/></filter>
                                                    <linearGradient id="cg" x1="0%" y1="0%" x2="100%" y2="100%">
                                                        <stop offset="0%" stopColor="var(--primary)"/>
                                                        <stop offset="100%" stopColor="var(--secondary)"/>
                                                    </linearGradient>
                                                </defs>
                                                {/* rings */}
                                                <circle cx={center.x} cy={center.y} r={ring1} className="wol2-ring" aria-hidden="true" />
                                                <circle cx={center.x} cy={center.y} r={ring2} className="wol2-ring" aria-hidden="true" />
                                                {/* links */}
                                                {positions.map(p => (
                                                    <line key={'l-'+p.id} x1={center.x} y1={center.y} x2={p.x} y2={p.y} className={`wol2-link ${active===p.id?'active':''}`} aria-hidden="true" />
                                                ))}
                                                {/* center node */}
                                                <g className="wol2-center" transform={`translate(${center.x},${center.y})`}>
                                                    <circle r="36" fill="url(#cg)" />
                                                    <text textAnchor="middle" dominantBaseline="middle" className="wol2-center-text">Diego</text>
                                                </g>
                                                {/* nodes */}
                                                                                                {positions.map(p => (
                                                                                                        <g key={p.id}
                                                         className={`wol2-node ${active===p.id?'active':''}`}
                                                         transform={`translate(${p.x},${p.y})`}
                                                         onMouseEnter={() => setActive(p.id)}
                                                         onMouseLeave={() => setActive(null)}
                                                         onFocus={() => setActive(p.id)}
                                                         onBlur={() => setActive(null)}
                                                         onClick={() => { setActive(null); p.action(); }}
                                                         role="button" tabIndex={0}
                                                         onKeyDown={(e)=>{ if(e.key==='Enter'||e.key===' ') { e.preventDefault(); setActive(null); p.action(); } }}>
                                                        <title>{p.label}</title>
                                                        <circle r="20" />
                                                        <text y="36" textAnchor="middle" className="wol2-label">{p.label}</text>
                                                    </g>
                                                ))}
                                            </svg>
                                        </div>
                                    );
                                }

                // The main App component. Assembles all sections and the navigation bar.
                function App() {
                        // Initialize dark mode from localStorage or system preference
                        const prefers = typeof window !== 'undefined' && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                        const storedPref = typeof window !== 'undefined' ? window.localStorage.getItem('darkMode') : null;
                        const initialDark = storedPref === null ? prefers : storedPref === 'true';
                        const [darkMode, setDarkMode] = React.useState(initialDark);
                        React.useEffect(() => {
                            const root = document.documentElement; // <html>
                            if (darkMode) root.classList.add('dark-mode'); else root.classList.remove('dark-mode');
                            window.localStorage.setItem('darkMode', darkMode ? 'true' : 'false');
                        }, [darkMode]);
                        const toggleDarkMode = () => setDarkMode(d => !d);
                        // Track active section for nav highlight
                        const [currentSection, setCurrentSection] = React.useState('home');
                        React.useEffect(() => {
                            const sections = Array.from(document.querySelectorAll('.section'));
                            const obs = new IntersectionObserver((entries) => {
                                entries.forEach(e => { if (e.isIntersecting && e.target.id) setCurrentSection(e.target.id); });
                            }, { rootMargin: '-45% 0px -45% 0px', threshold: [0, 0.25, 0.5, 0.75, 1] });
                            sections.forEach(s => obs.observe(s));
                            return () => obs.disconnect();
                        }, []);

                        // State for the chatbot open/closed status and chat messages
            const [chatOpen, setChatOpen] = React.useState(false);
            const [chatInput, setChatInput] = React.useState('');
            const [messages, setMessages] = React.useState(() => {
                try {
                    const raw = localStorage.getItem('chatMessagesV1');
                    if(raw){
                        const parsed = JSON.parse(raw);
                        if(Array.isArray(parsed) && parsed.every(m=>m && typeof m.text==='string' && m.from)) return parsed;
                    }
                } catch {}
                return [{ from: 'bot', text: 'Hello! I\'m your personal assistant. How can I help you?' }];
            });
            const [typing, setTyping] = React.useState(false);
            // Reintroduce simple Auto/Local toggle + Clear + Check buttons
            const [forceLocal, setForceLocal] = React.useState(() => { try { return localStorage.getItem('forceLocalChat')==='1'; } catch { return false; } });
            const messagesEndRef = React.useRef(null);
            React.useEffect(()=>{ if(messagesEndRef.current){ messagesEndRef.current.scrollIntoView({behavior:'smooth'}); } },[messages]);
            React.useEffect(()=>{ try { localStorage.setItem('chatMessagesV1', JSON.stringify(messages.slice(-250))); } catch {} }, [messages]);

                        // Resolve chat base for health checks and requests
                        const getChatBase = React.useCallback(() => {
                            const configured = (window.CHAT_API_BASE || '').trim();
                            return (configured || (location.hostname === 'localhost' ? 'http://localhost:8787' : '')).replace(/\/$/, '');
                        }, []);
                        const { healthy: chatHealthy, check: checkChatHealth } = useChatHealth(getChatBase);

            // Replace the ChatGPT helper with a Gemini helper. This function calls
            // Google’s Gemini generative API using the supplied API key. The API
            // key is embedded directly in the endpoint URL as required by the
            // Gemini REST specification. If the call fails, a fallback message is
            // returned. See Google’s documentation for additional details【744721557993995†L420-L448】.
            // Assistant engine initialization (modular)
            const assistantEngine = new (window.AssistantEngine||function(){return {ask: async ()=> 'Assistant not loaded'}})();

            // Optional lightweight self-test: append '?selftest=1' to URL to log sample local answers (does not alter UI state)
            (function(){
                if(location.search.includes('selftest=1') && !window.__chatSelfTested){
                    window.__chatSelfTested = true;
                    const samples = ['skills','experience','projects','education','contact','hi','unknown topic'];
                    console.group('[chat selftest] local responder');
                    Promise.all(samples.map(q => getAIReply(q).then(r => ({q,r})))).then(rows => {
                        rows.forEach(row => console.log(row.q + ' -> ' + row.r));
                        console.groupEnd();
                    });
                }
            })();

            // Handle sending a chat message. This helper is invoked when the user
            // presses Enter or clicks the Send button. It appends the user’s
            // message to the chat, clears the input, calls getAIReply() and
            // appends the bot’s response.
            const handleChatSend = async () => {
                if (chatInput.trim() === '' || typing) return;
                const input = chatInput.trim();
                setMessages(prev => [...prev, { from: 'user', text: input, ts: Date.now() }]);
                setChatInput('');
                setTyping(true);
                try {
                    const reply = await assistantEngine.ask(input);
                    setMessages(prev => [...prev, { from: 'bot', text: reply, ts: Date.now() }]);
                } finally {
                    setTyping(false);
                }
            };

            // Handle Enter key by delegating to handleChatSend()
            const handleChatKeyPress = (e) => {
                if (e.key === 'Enter') {
                    handleChatSend();
                }
            };

            return (
                <div id="main-content" role="main" tabIndex="-1">
                    <NavBar darkMode={darkMode} toggleDarkMode={toggleDarkMode} currentSection={currentSection} />
                    {/* Home section with interactive wipe hero and intro content */}
                    <Section id="home" title="">
                        <div className="wipe-hero" role="img" aria-label="Interactive reveal hero">
                            {/* Clear image (underlay). Width/height hint to avoid CLS */}
                            <img id="hero-clear" className="hero-clear-img" src="images/img_trees.png" width="1920" height="1080" loading="eager" decoding="async" fetchpriority="high" alt="Background" />
                            {/* Canvas overlay for wipe effect */}
                            <canvas id="wipeCanvas" className="wipe-hero-canvas" aria-hidden="true"></canvas>
                            {/* Foreground intro content stays above the canvas */}
                            <div className="hero hero-intro" style={{position:'relative', zIndex:1}}>
                                <div className="hero-badge">Software Engineer</div>
                                <h1 className="hero-title">I build fast, human-friendly data tools.</h1>
                                <p className="hero-lead">Cut LCP 4.2s→1.6s, −41% bundles, shipped AI tools used by 3 teams.</p>
                                <div className="hero-ctas">
                                    <a href="#projects" className="btn btn-primary">
                                        <span>View Projects</span>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                            <path d="M7 17L17 7M17 7H7M17 7V17" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                        </svg>
                                    </a>
                                    <a href="Diego_Resume.pdf" className="btn btn-secondary" target="_blank" rel="noopener">
                                        <span>Download Résumé</span>
                                    </a>
                                    <button type="button" className="btn reveal-btn" id="reveal-now">Reveal instantly</button>
                                </div>
                                <div className="hero-stats">
                                    <div className="stat">
                                        <span className="stat-number">5+</span>
                                        <span className="stat-label">Years Experience</span>
                                    </div>
                                    <div className="stat">
                                        <span className="stat-number">20+</span>
                                        <span className="stat-label">Projects Delivered</span>
                                    </div>
                                    <div className="stat">
                                        <span className="stat-number">3</span>
                                        <span className="stat-label">Cloud Platforms</span>
                                    </div>
                                </div>
                            </div>
                            {/* Down arrow CTA to scroll to About section */}
                            <div className="wipe-hero-overlay">
                                <button className="down-arrow" aria-label="Scroll to content" onClick={()=>{ const el=document.getElementById('about'); if(el) el.scrollIntoView({behavior:'smooth'}); }}>
                                    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 16.5c-.26 0-.51-.1-.71-.29l-6-6a1.003 1.003 0 0 1 1.42-1.42L12 13.59l5.29-5.3a1.003 1.003 0 0 1 1.42 1.42l-6 6c-.2.19-.45.29-.71.29z"/></svg>
                                </button>
                            </div>
                        </div>
                    </Section>
                    {/* Challenge game section (Minesweeper) */}
                    <Section id="challenge" title="Challenge: Minesweeper">
                        <GameMinesweeper />
                    </Section>
                    {/* Web of Life section */}
                    <Section id="web-of-life" title="Web of Life">
                        <p style={{marginTop:0}}>Hover or tap nodes to explore my work and background.</p>
                        <WebOfLife />
                    </Section>
                    {/* About section describing Diego’s professional summary */}
                    <Section id="about" title="About">
                        <p>
                            I'm a multidisciplinary software engineer specializing in DevOps, full‑stack web development and
                            cloud automation. Over the past few years I've streamlined deployments, enhanced system
                            reliability and delivered AI‑driven solutions. I'm passionate about leveraging cutting‑edge
                            technologies to solve complex problems and love tackling new challenges.
                        </p>
                    </Section>
                    {/* Skills section listing grouped skills */}
                    <Section id="skills" title="Skills">
                        <ul className="skills‑list">
                            <li><strong>Cloud & DevOps:</strong> Azure, AWS (EC2, S3, Lambda), GitHub Actions, CI/CD, Infrastructure as Code</li>
                            <li><strong>Programming & Web:</strong> JavaScript, TypeScript, PowerShell, Python, C++, HTML5, CSS3</li>
                            <li><strong>Databases:</strong> MongoDB, SQL</li>
                            <li><strong>AI & Automation:</strong> OpenAI API, Generative AI, Prompt Engineering, Test Automation</li>
                            <li><strong>3D & Simulation:</strong> Unreal Engine, NVIDIA Omniverse, VR/AR Development</li>
                            <li><strong>Tools:</strong> Git, GitHub Copilot, Docker, SCTP, TLS, DPDK/VPP</li>
                        </ul>
                    </Section>
                    {/* Experience section with card-based layout and impact metrics */}
                    <Section id="experience" title="Experience">
                        <div className="experience-new">
                            <article className="xp-card">
                                <header className="xp-head">
                                    <h3><span className="role">Software Engineer (DevOps)</span> — <a href="https://www.cae.com" className="company">CAE</a></h3>
                                <span className="job‑date">May 2025 – Present</span>
                                <ul>
                                    <li>Developed and maintained automation pipelines with Azure and GitHub Actions, boosting deployment efficiency by 30%.</li>
                                    <li>Partnered with cross‑functional teams to optimize asset flow, reducing system downtime by 25%.</li>
                                    <li>Engineered cloud computing solutions using JavaScript and PowerShell, improving overall system reliability and scalability.</li>
                                </ul>
                                </header>
                            </article>
                            <div className="job">
                                <h3>IVR System Developer – CAE</h3>
                                <span className="job‑date">Sep 2024 – May 2025</span>
                                <ul>
                                    <li>Proposed continual improvements to IVR functionality and user experience, driving measurable gains in customer satisfaction.</li>
                                    <li>Developed and optimized automated test scripts (JavaScript, XML, JSON), boosting testing coverage and reducing defects.</li>
                                    <li>Analyzed test outcomes, identified root causes and collaborated with cross‑functional teams to enhance system reliability.</li>
                                </ul>
                            </div>
                            <div className="job">
                                <h3>Software Engineer Intern – CAE</h3>
                                <span className="job‑date">Oct 2023 – Sep 2024</span>
                                <ul>
                                    <li>Contributed to the Ondulus IR team, developing and testing advanced simulation technologies including night vision, LiDAR and infrared systems.</li>
                                    <li>Led C++ sensor testing processes and optimized algorithms to automate testing workflows.</li>
                                    <li>Created comprehensive test cases to validate physics‑based simulation modules under diverse conditions.</li>
                                </ul>
                            </div>
                            <div className="job">
                                <h3>Simulation Developer – Presagis</h3>
                                <span className="job‑date">Jun 2022 – Jun 2023</span>
                                <ul>
                                    <li>Coded simulations using NVIDIA Omniverse Isaac Sim, implementing machine‑learning, point‑cloud and lidar technology for AI solutions.</li>
                                    <li>Integrated USD workflows into Velocity5D and created digital twins with 3D modelling, texturing and mapping.</li>
                                    <li>Collaborated with developers and 3D artists; utilized Python for automation and tool development.</li>
                                </ul>
                            </div>
                            <div className="job">
                                <h3>3D Artist/Developer – Presagis</h3>
                                <span className="job‑date">Sep 2021 – Jun 2022</span>
                                <ul>
                                    <li>Built a library of custom 3D models, textures and animations using Unreal Engine, Omniverse and Blender.</li>
                                    <li>Employed Python scripting to streamline asset creation and optimize 3D workflows.</li>
                                    <li>Collaborated with cross‑functional teams to deliver visually engaging simulation assets.</li>
                                </ul>
                            </div>
                        </div>
                    </Section>
                    {/* Projects section highlighting major projects */}
                    <Section id="projects" title="Projects">
                        <div className="projects">
                            <div className="project">
                                <h3>VR Brain Installation</h3>
                                <p>
                                    Lead VR/AI Developer working with McGill University’s neuroscience team to translate authentic neural imaging data into an immersive VR experience. Built AI‑powered pipelines and optimized 3D environments in Unreal Engine for high‑fidelity visualization.
                                </p>
                            </div>
                            <div className="project">
                                <h3>The Actual Informer</h3>
                                <p>
                                    Full‑stack news summarization web app built with TypeScript, Node.js and Express, deployed on AWS. Integrated OpenAI’s API to rewrite and shorten articles, improving readability and engagement. Designed a responsive user interface with HTML5 and CSS3.
                                </p>
                            </div>
                        </div>
                        {/* Featured projects: highlight portfolio additions */}
                        <div className="featured-projects">
                            <div className="project-card">
                                <h3>Real-Time Dashboard</h3>
                                <p>
                                    A Python Dash application that streams and visualizes data in real time. Includes a data source selector
                                    and update-interval slider. View the code on
                                    {' '}
                                    <a href="https://github.com/diegocrisafu/realtime-dashboard" target="_blank" rel="noopener noreferrer">GitHub</a>.
                                </p>
                            </div>
                            <div className="project-card">
                                <h3>Expense Tracker</h3>
                                <p>
                                    A React-based expense tracker app with local persistence, deletion and a category pie chart. Open it directly
                                    via its <a href="https://diegocrisafu.github.io/expense/" target="_blank" rel="noopener noreferrer">live page</a> once
                                    GitHub Pages is enabled, or see the code on{' '}
                                    <a href="https://github.com/diegocrisafu/expense" target="_blank" rel="noopener noreferrer">GitHub</a>.
                                </p>
                            </div>
                        </div>
                    </Section>
                    {/* Education section listing academic background */}
                    <Section id="education" title="Education">
                        <div className="education">
                            <div className="school">
                                <h3>Concordia University</h3>
                                <span className="school‑date">2022 – Present</span>
                                <p>Double Major in Computational Design & Computer Science. Engaged in projects spanning 3D graphics, high‑performance computing and AI development.</p>
                            </div>
                            <div className="school">
                                <h3>Marianopolis College</h3>
                                <span className="school‑date">2020 – 2022</span>
                                <p>DEC in Commerce. Strengthened critical thinking and methodology skills with a focus on business and information systems.</p>
                            </div>
                        </div>
                    </Section>
                    {/* Contact section with functional form and accessibility */}
                                        <section id="contact" aria-labelledby="contact-title">
                                            <h2 id="contact-title">Let’s build something fast.</h2>
                                            <div className="theme-toggle" role="group" aria-label="Theme">
                                                    <button type="button" data-theme="system">System</button>
                                                    <button type="button" data-theme="light">Light</button>
                                                    <button type="button" data-theme="dark">Dark</button>
                                                </div>
                                            <p className="sub">Email is fastest — I reply within 24 hours.</p>

                        <div className="cta-row">
                                                <a
                                                  id="email-link"
                                                  className="btn btn-primary"
                                                  href="#"
                                                  rel="nofollow"
                                                  data-email-user="diego.crisafu"
                                                  data-email-domain="gmail.com"
                                                >Email Diego</a>
                                                <button className="btn" id="copy-email" type="button" aria-label="Copy email to clipboard">Copy email</button>
                                                <button className="btn" id="open-email" type="button" aria-label="Open email client">Open email</button>
                        </div>

                        <ul className="social" aria-label="Social links">
                            <li><a href="https://github.com/diegoc55" target="_blank" rel="me noopener noreferrer" aria-label="GitHub">GitHub</a></li>
                            <li><a href="https://www.linkedin.com/in/diegocrisafulli212bb0256" target="_blank" rel="me noopener noreferrer" aria-label="LinkedIn">LinkedIn</a></li>
                        </ul>

                                            <form action="https://formsubmit.co/diego.crisafu@gmail.com" method="POST" id="contact-form" noValidate>
                            <input type="hidden" name="_subject" value="Portfolio contact" />
                            <input type="hidden" name="_captcha" value="false" />
                                                <input type="hidden" name="form_started_at" id="form_started_at" />
                            <div className="hp"><label htmlFor="hp">Leave this empty</label><input id="hp" name="_honey" autoComplete="off" /></div>

                            <div className="field">
                                <label htmlFor="name">Name</label>
                                <input id="name" name="name" type="text" autoComplete="name" required />
                            </div>
                            <div className="field">
                                <label htmlFor="email">Email</label>
                                <input id="email" name="email" type="email" autoComplete="email" required inputMode="email" />
                            </div>
                            <div className="field">
                                <label htmlFor="message">Message</label>
                                <textarea id="message" name="message" rows="6" required></textarea>
                            </div>
                                                        <div className="send-row" aria-live="polite">
                                                            <button className="btn btn-primary" type="submit" id="send-btn">Send message</button>
                                                            <p id="form-status" className="form-status" role="status"></p>
                                                        </div>
                                                <p className="sub" style={{marginTop:8}}>We only use your details to respond. No tracking pixels. <a href="/privacy.html">Privacy</a>.</p>
                                            </form>

                                                                                        <div id="contact-success" className="card" hidden>
                                                                                            <h3>Thanks — message received.</h3>
                                                                                            <p>I’ll reply within 24 hours.</p>
                                                                                            <div className="cta-row">
                                                                                                <a className="btn btn-primary" href="/Diego_Resume.pdf" target="_blank" rel="noopener">Download résumé</a>
                                                                                                <a className="btn" href="#projects">Top project</a>
                                                                                                <a className="btn" id="email-again" href="#">Send another</a>
                                                                                            </div>
                                                                                        </div>
                                            <div id="toast" role="status" aria-live="polite" hidden>Email copied</div>
                    </section>
                    <footer className="footer">© {new Date().getFullYear()} Diego Crisafulli</footer>
                    {/* Floating chatbot component */}
                    <div className="chatbot-container">
                        {/* Chat icon toggles the chat window on click */}
                        <div
                            className="chat-icon"
                            role="button"
                            aria-label={chatOpen ? 'Close chat' : 'Open chat'}
                            aria-pressed={chatOpen}
                            tabIndex="0"
                            onKeyDown={(e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); setChatOpen(o=>!o);} }}
                            onClick={() => setChatOpen(!chatOpen)}
                        >
                            💬
                        </div>
                        {chatOpen && (
                            <div className="chat-window">
                                {/* Header with title, close and clear buttons */}
                                <div className="chat-window-header">
                                    <h4>
                                        <span className={`chat-status-dot ${chatHealthy ? 'online' : 'offline'}`} title={chatHealthy ? 'Online' : 'Offline'}></span>
                                        Assistant
                                    </h4>
                                    <div className="chat-window-controls">
                                        <button className="chat-clear-btn" onClick={()=>{ const next=!forceLocal; setForceLocal(next); try{ if(next) localStorage.setItem('forceLocalChat','1'); else localStorage.removeItem('forceLocalChat'); }catch{}; }} title={forceLocal? 'Forced local mode. Click for auto remote.':'Auto mode. Click to force local.'}>{forceLocal? 'Local':'Auto'}</button>
                                        <button className="chat-clear-btn" aria-label="Clear conversation" onClick={()=> setMessages([{from:'bot', text:"Hello! I'm your personal assistant. How can I help you?"}])}>Clear</button>
                                        <button className="chat-clear-btn" aria-label="Check backend health" onClick={()=>checkChatHealth()}>Check</button>
                                        <button className="chat-close-btn" aria-label="Close chat window" onClick={()=> setChatOpen(false)}>\u00d7</button>
                                    </div>
                                </div>
                                <div className="chat-messages">
                                    {messages.map((msg, idx) => {
                                        const time = msg.ts ? new Date(msg.ts) : null;
                                        const hh = time ? time.getHours().toString().padStart(2,'0') : '';
                                        const mm = time ? time.getMinutes().toString().padStart(2,'0') : '';
                                        const label = time ? `${hh}:${mm}` : '';
                                        return (
                                            <div key={idx} className={`chat-message ${msg.from}`} title={time?time.toLocaleString():undefined}>
                                                <div className="chat-message-text">{msg.text}</div>
                                                {time && <div className="chat-message-time" aria-hidden="true">{label}</div>}
                                            </div>
                                        );
                                    })}
                                    {typing && (
                                        <div className="chat-message bot" aria-live="polite"><span className="typing-dots"><span></span><span></span><span></span></span></div>
                                    )}
                                    <div ref={messagesEndRef} />
                                </div>
                                {/* Suggestions removed for cleaner minimal UI */}
                                {/* Input area with send button */}
                                <div className="chat-input-container">
                                    <textarea
                                        className="chat-input chat-textarea"
                                        placeholder="Type a message..."
                                        value={chatInput}
                                        rows={1}
                                        onChange={(e) => {
                                            const val=e.target.value; setChatInput(val);
                                            e.target.style.height='auto';
                                            const h = Math.min(e.target.scrollHeight, 120);
                                            e.target.style.height = h + 'px';
                                        }}
                                        onKeyDown={(e)=>{
                                            if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); handleChatSend(); }
                                        }}
                                        style={{resize:'none', overflow:'auto'}}
                                    />
                                    <button className="chat-send-btn" onClick={handleChatSend}>Send</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

                // Chat health util inside App scope
                function useChatHealth(getBase) {
                    const [healthy, setHealthy] = React.useState(false);
                    const check = React.useCallback(async () => {
                        try {
                            const base = getBase();
                            if (!base) { setHealthy(false); return false; }
                            // try /health (node) first, then root (worker)
                            let ok = false;
                            try {
                                const r1 = await fetch(`${base}/health`, { method: 'GET' });
                                ok = r1.ok;
                                if (!ok) throw new Error('health not ok');
                            } catch {
                                const r2 = await fetch(base, { method: 'GET' });
                                ok = r2.ok;
                            }
                            setHealthy(!!ok);
                            return ok;
                        } catch {
                            setHealthy(false);
                            return false;
                        }
                    }, [getBase]);
                    // poll every 30s
                    React.useEffect(() => {
                        check();
                        const id = setInterval(check, 30000);
                        return () => clearInterval(id);
                    }, [check]);
                    return { healthy, check };
                }

                // Render the App component into the root div
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    
    <!-- Initialize interactive wipe effect for Home hero -->
    <script>
        (function(){
            function initWipe(){
                const rootFlag = (document.body && document.body.getAttribute('data-hero-reveal')) || 'on';
                if (rootFlag !== 'on') return; // kill-switch

                const canvas = document.getElementById('wipeCanvas');
                const revealBtn = document.getElementById('reveal-now');
                if(!canvas) return;
                const ctx = canvas.getContext('2d');
                const DPR = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));
                const overlay = new Image();
                overlay.src = 'images/Golden Trunks and Blue Sky.png';
                let brushRadius = Math.max(50, Math.min(90, Math.floor((window.innerWidth||800) * 0.05))); // responsive brush
                let paused = false;
                let revealed = false;

                // Reduced motion: skip scratching and crossfade
                const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

                function sizeCanvas(){
                    const rect = canvas.getBoundingClientRect();
                    const w = rect.width || window.innerWidth;
                    const h = rect.height || window.innerHeight;
                    canvas.style.width = w + 'px';
                    canvas.style.height = h + 'px';
                    canvas.width = Math.floor(w * DPR);
                    canvas.height = Math.floor(h * DPR);
                    ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
                }

                function drawOverlay(){
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.clearRect(0,0,canvas.width,canvas.height);
                    // soft blur for the overlay to create contrast with underlay
                    ctx.filter = 'blur(10px)';
                    const cw = canvas.width / DPR;
                    const ch = canvas.height / DPR;
                    const iw = overlay.naturalWidth || overlay.width;
                    const ih = overlay.naturalHeight || overlay.height;
                    if (iw && ih) {
                        const scale = Math.max(cw / iw, ch / ih);
                        const dw = iw * scale;
                        const dh = ih * scale;
                        const dx = (cw - dw) / 2;
                        const dy = (ch - dh) / 2;
                        ctx.drawImage(overlay, dx, dy, dw, dh);
                    } else {
                        ctx.drawImage(overlay, 0, 0, cw, ch);
                    }
                    ctx.filter = 'none';
                }

                function eraseAt(x,y){
                    const r = brushRadius;
                    ctx.save();
                    ctx.globalCompositeOperation = 'destination-out';
                    const g = ctx.createRadialGradient(x,y, r*0.5, x,y, r);
                    g.addColorStop(0,'rgba(0,0,0,0.9)');
                    g.addColorStop(1,'rgba(0,0,0,0)');
                    ctx.fillStyle = g;
                    ctx.beginPath();
                    ctx.arc(x,y,r,0,Math.PI*2);
                    ctx.fill();
                    ctx.restore();
                }

                function getXY(e){
                    const rect = canvas.getBoundingClientRect();
                    return { x: e.clientX - rect.left, y: e.clientY - rect.top };
                }

                // Progress estimation using downscaled alpha sampling
                const sampleCanvas = document.createElement('canvas');
                const sampleCtx = sampleCanvas.getContext('2d', { willReadFrequently: true });
                sampleCanvas.width = 64; sampleCanvas.height = 64;
                let lastSampleTs = 0;
                function estimateCleared(){
                    const now = performance.now();
                    if (now - lastSampleTs < 300) return 0; // throttle
                    lastSampleTs = now;
                    sampleCtx.clearRect(0,0,64,64);
                    sampleCtx.drawImage(canvas, 0, 0, 64, 64);
                    const data = sampleCtx.getImageData(0,0,64,64).data;
                    let cleared = 0, total = 64*64;
                    for (let i=3; i<data.length; i+=4){ // alpha channel
                        if (data[i] < 16) cleared++;
                    }
                    return cleared / total;
                }

                function revealInstant(){
                    if (revealed) return;
                    revealed = true;
                    canvas.style.transition = 'opacity 480ms ease-out';
                    canvas.style.opacity = '0';
                    canvas.style.pointerEvents = 'none';
                    setTimeout(()=>{ canvas.hidden = true; }, 520);
                }

                // Pointer handling
                let down = false;
                function onDown(e){ if (paused || revealed) return; down = true; const p=getXY(e); eraseAt(p.x,p.y); checkProgress(true); }
                function onMove(e){ if (paused || revealed) return; if (!down && e.pointerType!=='mouse') return; const p=getXY(e); eraseAt(p.x,p.y); checkProgress(false); }
                function onUp(){ down = false; }
                function onCancel(){ down = false; }

                function checkProgress(force){
                    if (!force && paused) return;
                    const ratio = estimateCleared();
                    if (ratio >= 0.6) revealInstant();
                }

                // Pause work when hero is offscreen
                const io = new IntersectionObserver((entries)=>{
                    const entry = entries[0];
                    paused = !entry.isIntersecting;
                    canvas.style.pointerEvents = paused ? 'none' : (revealed ? 'none' : 'auto');
                }, { threshold: 0.05 });
                const hero = canvas.closest('.wipe-hero');
                if (hero) io.observe(hero);

                // Wire listeners
                canvas.addEventListener('pointerdown', onDown);
                canvas.addEventListener('pointermove', onMove);
                window.addEventListener('pointerup', onUp);
                window.addEventListener('pointercancel', onCancel);
                window.addEventListener('resize', ()=>{ sizeCanvas(); if (overlay.complete) drawOverlay(); });
                if (revealBtn) revealBtn.addEventListener('click', revealInstant);

                overlay.onload = () => {
                    sizeCanvas();
                    drawOverlay();
                    if (prefersReduced) {
                        // Respect reduced motion preference
                        requestAnimationFrame(revealInstant);
                    }
                };

                // If image already cached
                if (overlay.complete) {
                    sizeCanvas();
                    drawOverlay();
                    if (prefersReduced) requestAnimationFrame(revealInstant);
                }
            }
            // Run after React app mounts to ensure canvas is in DOM
            window.addEventListener('DOMContentLoaded', ()=> setTimeout(initWipe, 0));
        })();
    </script>
    
    <script>
            // Register service worker for basic offline support
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('./sw.js').catch(() => {});
                });
            }
        </script>
    <script>
        // Toggle minimal transparent navbar at top of the page
        (function(){
            function onScroll(){
                const atTop = window.scrollY < 8; // small threshold
                document.documentElement.classList.toggle('at-top', atTop);
            }
            window.addEventListener('scroll', onScroll, { passive: true });
            window.addEventListener('DOMContentLoaded', onScroll);
        })();
    </script>
    
    <script>
        // Contact section functionality with validation, rate limit, and inline success
        document.addEventListener('DOMContentLoaded', function() {
            const emailLink = document.getElementById('email-link');
            const copyBtn = document.getElementById('copy-email');
            const openBtn = document.getElementById('open-email');
            const toast = document.getElementById('toast');
            const contactForm = document.getElementById('contact-form');
            const formStatus = document.getElementById('form-status');
            const sendBtn = document.getElementById('send-btn');
            const successCard = document.getElementById('contact-success');
            const emailAgain = document.getElementById('email-again');
            const startTs = document.getElementById('form_started_at');

            // Reconstruct email address from obfuscated parts
            let realEmail = '';
            if (emailLink && emailLink.dataset.emailUser && emailLink.dataset.emailDomain) {
                realEmail = emailLink.dataset.emailUser + '@' + emailLink.dataset.emailDomain;
                emailLink.href = 'mailto:' + realEmail;
            }

            // Copy utility with toast and fallback
            function showToast(msg){
                if (!toast) return;
                toast.textContent = msg;
                toast.hidden = false;
                toast.classList.add('show');
                setTimeout(()=>{ toast.hidden=true; toast.classList.remove('show'); }, 2500);
            }
            async function copyText(text){
                try { await navigator.clipboard.writeText(text); return true; }
                catch {
                    const el = document.createElement('input');
                    el.value = text; document.body.appendChild(el); el.select();
                    try { document.execCommand('copy'); } catch { document.body.removeChild(el); return false; }
                    document.body.removeChild(el); return true;
                }
            }
            if (copyBtn) {
                copyBtn.addEventListener('click', async () => {
                    const ok = await copyText(realEmail || '');
                    showToast(ok ? 'Email copied' : 'Copy failed — use the email button');
                });
            }
            if (openBtn) {
                openBtn.addEventListener('click', () => {
                    const subject = encodeURIComponent('Portfolio inquiry');
                    const body = encodeURIComponent('Hi Diego,\n\n');
                    const href = `mailto:${realEmail}?subject=${subject}&body=${body}`;
                    window.location.href = href;
                });
            }

            if (emailAgain) {
                emailAgain.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (successCard) successCard.hidden = true;
                    if (contactForm) {
                        contactForm.reset();
                        contactForm.hidden = false;
                        const name = document.getElementById('name');
                        if (name) name.focus();
                    }
                });
            }

            // Inline success if URL has ?success=1
            if (location.search.includes('success=1')) {
                if (contactForm) contactForm.hidden = true;
                if (successCard) successCard.hidden = false;
            }

            // Initialize honeypot timestamp
            if (startTs) startTs.value = Date.now();

            function setError(input, msg){
                if (!input) return;
                input.setAttribute('aria-invalid','true');
                const id = input.id + '-err';
                let p = document.getElementById(id);
                if (!p) { p = document.createElement('p'); p.id = id; p.className = 'err'; p.setAttribute('role','alert'); input.parentNode.appendChild(p); }
                p.textContent = msg;
                const describedby = (input.getAttribute('aria-describedby')||'').split(' ').filter(Boolean);
                if (!describedby.includes(id)) { describedby.push(id); input.setAttribute('aria-describedby', describedby.join(' ')); }
            }
            function clearError(input){
                if (!input) return;
                input.removeAttribute('aria-invalid');
                const id = input.id + '-err';
                const p = document.getElementById(id);
                if (p) p.remove();
                const describedby = (input.getAttribute('aria-describedby')||'').split(' ').filter(t=>t && t!==id);
                if (describedby.length) input.setAttribute('aria-describedby', describedby.join(' ')); else input.removeAttribute('aria-describedby');
            }

            function validate(){
                const name = document.getElementById('name');
                const email = document.getElementById('email');
                const message = document.getElementById('message');
                let firstInvalid = null;
                // name
                if (!name.value || name.value.trim().length < 2) { setError(name,'Please enter at least 2 characters.'); firstInvalid = firstInvalid || name; } else clearError(name);
                // email RFC-5322-light
                const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim());
                if (!emailOk) { setError(email,'Enter a valid email address.'); firstInvalid = firstInvalid || email; } else clearError(email);
                // message length
                const len = (message.value||'').trim().length;
                if (len < 20 || len > 2000) { setError(message,'Message must be 20–2000 characters.'); firstInvalid = firstInvalid || message; } else clearError(message);
                return firstInvalid;
            }

            let busy = false; let lastSent = 0; let countdownTimer = null;
            function startCooldown(){
                const total = 30; let left = total;
                function tick(){
                    if (!sendBtn) return; left -= 1;
                    if (left <= 0){ sendBtn.disabled=false; sendBtn.textContent='Send message'; clearInterval(countdownTimer); countdownTimer=null; }
                    else { sendBtn.textContent = `Wait ${left}s…`; }
                }
                sendBtn.disabled = true; sendBtn.textContent = `Wait ${left}s…`;
                countdownTimer = setInterval(tick, 1000);
            }

            if (contactForm) {
                contactForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    if (busy) return;

                    const firstInvalid = validate();
                    if (firstInvalid) { firstInvalid.focus(); return; }

                    // Honeypot time threshold
                    const started = Number(startTs && startTs.value || 0);
                    if (!started || (Date.now() - started) < 3000){
                        formStatus.textContent = 'Please take a moment to complete the form.';
                        return;
                    }

                    busy = true; sendBtn.disabled = true; sendBtn.textContent = 'Sending…'; formStatus.textContent = '';

                    try {
                        const resp = await fetch(contactForm.action, { method: 'POST', body: new FormData(contactForm), mode: 'no-cors' });
                        // Treat no-cors as success
                        contactForm.hidden = true; if (successCard) successCard.hidden = false; lastSent = Date.now();
                        startCooldown();
                    } catch (err) {
                        formStatus.textContent = 'Network error — try again or email me directly.';
                        sendBtn.disabled = false; sendBtn.textContent = 'Send message';
                    } finally { busy = false; }
                });
            }

            if (emailAgain) {
                emailAgain.addEventListener('click', (e)=>{
                    e.preventDefault();
                    if (successCard) successCard.hidden = true; if (contactForm) contactForm.hidden = false; contactForm.reset(); clearError(document.getElementById('name')); clearError(document.getElementById('email')); clearError(document.getElementById('message')); if (startTs) startTs.value = Date.now();
                });
            }
        });
    </script>
    
        <script>
        (() => {
            const KEY='theme', root=document.documentElement;
            const saved=localStorage.getItem(KEY);
            if (saved==='light' || saved==='dark') root.setAttribute('data-theme', saved);

            document.querySelectorAll('.theme-toggle [data-theme]').forEach(b=>{
                b.addEventListener('click', ()=>{
                    const mode=b.getAttribute('data-theme');
                    if (mode==='system'){ localStorage.removeItem(KEY); root.removeAttribute('data-theme'); }
                    else { localStorage.setItem(KEY, mode); root.setAttribute('data-theme', mode); }
                });
            });
        })();
        </script>
    
</body>
</html>